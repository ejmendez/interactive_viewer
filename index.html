<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>WebSocker Client</title>

</head>

<body>
    <button onclick="switchLight()">On / Off</button>
    <button onclick="vibrate()">Vibration On / Off</button>
    <h2>
    Console output
    </h2>
    <div id="console">
    </div>
</body>

<script>

let mode = false;
let track = "";

let canVibrate = false;
if('vibrate' in navigator) {
  canVibrate = true;
}


function vibrate() {
  console.log("Vibration "+ canVibrate)
  if (canVibrate) {
    navigator.vibrate(500);
  }
  //navigator.vibrate(0)
}

function switchLight() {
  mode = !mode

  if(track) {

    const constraints = {
            advanced: [{
              torch:mode,
            }]
          };

    track.applyConstraints(constraints)
    .then(() => {
      console.log("successful")
      // Do something with the track such as using the Image Capture API.
    })
  }
};

  //have a console on mobile
  const consoleOutput = document.getElementById("console");
  const log = function (msg) {
    consoleOutput.innerText = `${consoleOutput.innerText}\n${msg}`;
    console.log(msg);
  }

  function enableCameraLight() {
        //Test browser support
        const SUPPORTS_MEDIA_DEVICES = 'mediaDevices' in navigator;

        if (SUPPORTS_MEDIA_DEVICES) {
          //Get the environment camera (usually the second one)
          navigator.mediaDevices.enumerateDevices().then(devices => {

            const cameras = devices.filter((device) => device.kind === 'videoinput');

            if (cameras.length === 0) {
              throw 'No camera found on this device.';
            }
            const camera = cameras[cameras.length - 1];


            // Create stream and get video track
            navigator.mediaDevices.getUserMedia({
              video: {
                deviceId: camera.deviceId,
                facingMode: ['user', 'environment'],
                height: {ideal: 1080},
                width: {ideal: 1920}
              }
            }).then(stream => {

                track = stream.getVideoTracks()[0];

                capabilities = track.getCapabilities()

                if (!capabilities.torch) {
                    console.log("torch is not supported")
                    track.stop()
                    console.log("torch is not supported")
                    track= ""
                }
            });


          });
          //The light will be on as long the track exists
        }
    }

  enableCameraLight()

</script>

</html>
